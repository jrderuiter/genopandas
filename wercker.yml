box:
  id: continuumio/miniconda3
  tag: latest

test:
  steps:
    - install-packages:
      packages: make
    - script:
      name: setup-conda-env
      code: |
        make env
        source activate genopandas-dev
        pip install .
    - script:
      name: pytest
      code: make test

docs:
  steps:
    - install-packages:
      packages: make
    - script:
      name: setup-conda-env
      code: |
        make env
        source activate genopandas-dev
        pip install .
    - script:
      name: change-remote
      code: git remote set-url origin https://{$GH_TOKEN}:x-oauth-basic@github.com/jrderuiter/genopandas.git
    - script:
      name: gh-pages
      code: make gh-pages

pypi:
  steps:
    - install-packages:
      packages: make
    - script:
      name: setup-conda-env
      code: |
        conda create -c conda-forge -n pypi python=3.6 setuptools wheel twine
        source activate pypi
    - script:
      name: build-wheel
      code: |
        rm -rf build
        python setup.py sdist bdist_wheel
    - script:
      name: upload-to-pypi
      code: |
        echo "[pypi]" > ~/.pypirc
        echo "username:" $PYPI_USER >> ~/.pypirc
        echo "password:" $PYPI_PASSWORD >> ~/.pypirc
        twine upload -r pypi dist/*
        rm -f  ~/.pypirc
