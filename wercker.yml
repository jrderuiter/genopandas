box:
  id: continuumio/miniconda3
  tag: latest

test:
  steps:
    - script:
      name: populate-conda-cache
      code: |-
        if test -d "$WERCKER_CACHE_DIR/conda-pkgs"; then rsync -avz "$WERCKER_CACHE_DIR/conda-pkgs/*" /opt/conda/pkgs; fi
        ls -alih "$WERCKER_CACHE_DIR/conda-pkgs"
    - install-packages:
      packages: make
    - script:
      name: install-conda-env
      code: |
        make env
        source activate genopandas-dev
        pip install .
    - script:
      name: pytest
      code: make test
    - script:
      name: store-conda-cache
      code: |
        rsync -avz /opt/conda/pkgs/* "$WERCKER_CACHE_DIR/conda-pkgs/"

docs:
  steps:
    - install-packages:
      packages: make
    - script:
      name: install-conda-env
      code: |
        make env
        source activate genopandas-dev
        pip install .
    - script:
      name: gh-pages
      code: make gh-pages
